<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" main="IE=edge">
  <title>WebWidgetRouter demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script type="importmap">
    {
      "imports": {
        "vue": "https://unpkg.com/vue@3.2.22/dist/system/vue.runtime.browser.prod.js",
        "@web-widget/container": "https://unpkg.com/@web-widget/container@0.0.27/dist/esm/main.js",
        "@ungap/custom-elements": "https://unpkg.com/@ungap/custom-elements@1.1.0/es.js",
        "@growing-web/web-router": "/dist/esm/web-router.js",
        "@examples/bootstrap": "/examples/bootstrap.js",
        "@examples/nav": "/examples/nav.widget.js",
        "@examples/home": "/examples/index.widget.js",
        "@examples/news": "/examples/news.widget.js",
        "@examples/about": "/examples/about.widget.js",
        "@examples/vue-router": "/examples/vue-router.widget.js",
        "@examples/404": "/examples/404.widget.js"
      }
    }
  </script>

  <style>
    body {
      margin: 0;
    }
  </style>
</head>

<body>

  <web-widget import="@examples/nav"></web-widget>

  <web-router></web-router>

  <!-- pre-fetching data -->
  <script type="application/pfd+json">
    {
      "id": "@1024",
      "username": "web widget"
    }
  </script>

  <script type="routemap">
    {
      "routes": [
        {
          "path": "/",
          "element": "main",
          "children": [
            {
              "title": "首页",
              "element": "web-widget",
              "index": true,
              "attributes": {
                "import": "@examples/home"
              }
            },
            {
              "path": "news",
              "element": "web-widget",
              "attributes": {
                "import": "@examples/news"
              }
            },
            {
              "path": "about",
              "title": "关于",
              "element": "web-widget",
              "attributes": {
                "import": "@examples/about",
                "data-id": "xxxx"
              }
            },
            {
              "path": "vue-router/*",
              "element": "web-widget",
              "attributes": {
                "import": "@examples/vue-router"
              }
            },
            {
              "path": "test",
              "element": "test-element",
              "attributes": {}
            },
            {
              "path": "*",
              "element": "web-widget",
              "attributes": {
                "import": "@examples/404"
              }
            }
          ],
          "attributes": {}
        }
      ]
    }
  </script>

  <script type="module">
    // Polyfill: Declarative Shadow DOM
    (function attachShadowRoots(root) {
      root.querySelectorAll("template[shadowroot]").forEach(template => {
        const mode = template.getAttribute("shadowroot");
        const host = template.parentNode;
        const shadowRoot = template.parentNode.attachShadow({ mode });
        const attachInternals = host.attachInternals;
        const attachShadow = host.attachShadow;

        Object.assign(host, {
          attachShadow() {
            shadowRoot.innerHTML = '';
            return shadowRoot;
          },
          attachInternals() {
            const ei = attachInternals ? attachInternals.call(this, arguments) : {};
            return Object.create(ei, { shadowRoot: { value: shadowRoot} });
          }
        });

        shadowRoot.appendChild(template.content);
        template.remove();
        attachShadowRoots(shadowRoot);
      });
    })(document);

    // Polyfill: Custom Elements
    // if (window.customElements) {
    //   customElements.define('test-builtin', class extends HTMLAnchorElement {}, { extends: 'a'});
    //   // Safari
    //   if (document.createElement('a', { is: 'test-builtin' }).constructor === HTMLAnchorElement) {
    //     document.head.appendChild(Object.assign(document.createElement('script'), {
    //       src: '//unpkg.com/@ungap/custom-elements/es.js',
    //       crossorigin: 'anonymous',
    //       async: true
    //     }));
    //   } 
    // }

    // Polyfill: Import Maps
    if (!HTMLScriptElement.supports || !HTMLScriptElement.supports('importmap')) {
      document.head.appendChild(Object.assign(document.createElement('script'), {
        src: 'https://unpkg.com/es-module-shims@1.5.6/dist/es-module-shims.js',
        crossorigin: 'anonymous',
        async: true,
        onload() {
          importShim('@examples/bootstrap');
        }
      }));
    } else {
      import('@examples/bootstrap');
    }
  </script>
</body>

</html>